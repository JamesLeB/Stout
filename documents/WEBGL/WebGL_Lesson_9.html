    <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">

<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<title>  WebGL Lesson 9 – improving the code structure with lots of moving objects | Learning WebGL</title>
<script type="text/javascript">
//<![CDATA[
try{if (!window.CloudFlare) {var CloudFlare=[{verbose:0,p:0,byc:0,owlid:"cf",bag2:1,mirage2:0,oracle:0,paths:{cloudflare:"/cdn-cgi/nexp/dok3v=1613a3a185/"},atok:"2c1b6781e0cb3014c3b88e10d5e2d90a",petok:"4a8d7979bc452b63b21aebbfa80b8da2d4f6972f-1421936883-1800",zone:"learningwebgl.com",rocket:"0",apps:{}}];CloudFlare.push({"apps":{"ape":"0c2c4619ebfbe8ac71a874c5c53773ca"}});!function(a,b){a=document.createElement("script"),b=document.getElementsByTagName("script")[0],a.async=!0,a.src="//ajax.cloudflare.com/cdn-cgi/nexp/dok3v=919620257c/cloudflare.min.js",b.parentNode.insertBefore(a,b)}()}}catch(e){};
//]]>
</script>
<link rel="stylesheet" href="http://learningwebgl.com/blog/wp-content/themes/modern-style/css/screen.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="http://learningwebgl.com/blog/wp-content/themes/modern-style/css/print.css" type="text/css" media="print" />
<!--[if IE]><link rel="stylesheet" href="http://learningwebgl.com/blog/wp-content/themes/modern-style/css/ie.css" type="text/css" media="screen, projection"><![endif]-->
<!--[if IE 6]>
	<script src="http://learningwebgl.com/blog/wp-content/themes/modern-style/js/pngfix.js"></script>
<![endif]--> 
<link rel="stylesheet" href="http://learningwebgl.com/blog/wp-content/themes/modern-style/style.css" type="text/css" media="screen" />
<link rel="alternate" type="application/rss+xml" title="Learning WebGL RSS Feed" href="http://learningwebgl.com/blog/?feed=rss2" />
<link rel="alternate" type="application/atom+xml" title="Learning WebGL Atom Feed" href="http://learningwebgl.com/blog/?feed=atom" />
<link rel="pingback" href="http://learningwebgl.com/blog/xmlrpc.php" />

<link rel="alternate" type="application/rss+xml" title="Learning WebGL &raquo; WebGL Lesson 9 – improving the code structure with lots of moving objects Comments Feed" href="http://learningwebgl.com/blog/?feed=rss2&amp;p=1008" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://learningwebgl.com/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://learningwebgl.com/blog/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Learning WebGL' href='http://learningwebgl.com/blog' />
<link rel='start' title='Hello, world!' href='http://learningwebgl.com/blog/?p=5' />
<link rel='prev' title='A happy Thanksgiving to all' href='http://learningwebgl.com/blog/?p=1022' />
<link rel='next' title='Debugging tip in Minefield' href='http://learningwebgl.com/blog/?p=1010' />
<meta name="generator" content="WordPress 2.9.2" />
<link rel='canonical' href='http://learningwebgl.com/blog/?p=1008' />
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>

</head>
<body>
	<div id="wrapper">
		<div id="container" class="container">  
                        
			<div class="span-16">
                <div id="header">
                    						<h1><a href="http://learningwebgl.com/blog">Learning WebGL</a></h1>
						<h2>3D Programming for the Web</h2>
										</div>
                
                <div class="navcontainer">
					<ul id="nav">
						<li ><a href="http://learningwebgl.com/blog/">Home</a></li>
						<li class="page_item page-item-1217"><a href="http://learningwebgl.com/blog/?page_id=1217" title="The Lessons">The Lessons</a></li>
<li class="page_item page-item-2438"><a href="http://learningwebgl.com/blog/?page_id=2438" title="WebGL Jobs">WebGL Jobs</a></li>
<li class="page_item page-item-988"><a href="http://learningwebgl.com/blog/?page_id=988" title="The WebGL Cookbook">The WebGL Cookbook</a></li>
<li class="page_item page-item-2"><a href="http://learningwebgl.com/blog/?page_id=2" title="About">About</a></li>
		
					</ul>
				</div>
            		<div id="content">	
                	
						
												<div class="post-1008 post hentry category-uncategorized clearfix" id="post-1008">
							<h2 class="title">WebGL Lesson 9 – improving the code structure with lots of moving objects</h2>
							<div class="postdate">
                                <span>November 26th, 2009</span> 
                                <span><a href="http://learningwebgl.com/blog/?p=1008#comments" title="Comment on WebGL Lesson 9 – improving the code structure with lots of moving objects">36 Comments</a></span>                             </div>
			
							<div class="entry">
                                								<p><span style="float: left; padding: 0px 20px 0px 0px;"><a href="http://learningwebgl.com/blog/?p=859">&lt;&lt; Lesson 8</a></span><span style="float: right; padding: 0px 20px 0px 0px;"><a href="http://learningwebgl.com/blog/?p=1067">Lesson 10 &gt;&gt;</a></span><br/><br />
Welcome to my number nine in my series of WebGL tutorials, based on <a href="http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=09">number 9</a> in the NeHe OpenGL tutorials.  In it, we&#8217;ll use JavaScript objects so that we can have a number of independently-animated objects in our 3d scene.  We&#8217;ll also touch on how to change the colour of a loaded texture and what happens when you blend textures together.</p>
<p>Here&#8217;s what the lesson looks like when run on a browser that supports WebGL:</p>
<p><object width="480" height="385"><param name="movie" value="http://www.youtube.com/v/Ti3jbuY4VlI&#038;hl=en_US&#038;fs=1&#038;hd=1"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/Ti3jbuY4VlI&#038;hl=en_US&#038;fs=1&#038;hd=1" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="480" height="385"></embed></object></p>
<p><a href="/lessons/lesson09/index.html">Click here and you&#8217;ll see the live WebGL version</a>, if you&#8217;ve got a browser that supports it; <a href="http://learningwebgl.com/blog/?p=11">here&#8217;s how to get one</a> if you don&#8217;t.  You should see a large number of differently-coloured stars, spiraling around.</p>
<p>You can use the checkbox underneath the canvas to switch on a &#8220;twinkling&#8221; effect, which we&#8217;ll look at later.  You can also use the cursor keys to spin the animation around its X axis, and you can zoom in and out using the <code>Page Up</code> and <code>Page Down</code> keys.</p>
<p>More on how it all works below&#8230;</p>
<p><span id="more-1008"></span></p>
<p>The usual <a href="http://learningwebgl.com/blog/?page_id=2">warning</a>: these lessons are targeted at people with a reasonable amount of programming knowledge, but no real experience in 3D graphics; the aim is to get you up and running, with a good understanding of what&#8217;s going on in the code, so that you can start producing your own 3D Web pages as quickly as possible.  If you haven&#8217;t read the previous tutorials already, you should probably do so before reading this one — here I will only explain the differences between the code for <a href="http://learningwebgl.com/blog/?p=859">lesson 8</a> and the new code.</p>
<p>There may be bugs and misconceptions in this tutorial.  If you spot anything wrong, let me know in the comments and I&#8217;ll correct it ASAP.</p>
<p>There are two ways you can get the code for this example; just &#8220;View Source&#8221; while you&#8217;re looking at the live version, or if you use GitHub, you can clone it (and the other lessons) from <a href="http://github.com/gpjt/webgl-lessons">the repository there</a>.</p>
<p>The best way to show how the code for this example differs from lesson 8&#8217;s is to start at the bottom of the file and work our way up, kicking off with <code>webGLStart</code>.  Here&#8217;s what the function looks like this time:</p>
<pre>
  function webGLStart() {
    var canvas = document.getElementById("lesson09-canvas");
    initGL(canvas);
    initShaders();
    initTexture();
    initBuffers();
    <span style="color: red">initWorldObjects();</span>

    gl.clearColor(0.0, 0.0, 0.0, 1.0);

    document.onkeydown = handleKeyDown;
    document.onkeyup = handleKeyUp;

    tick();
  }
</pre>
<p>I&#8217;ve highlighted one change in red; the call to the new <code>initWorldObjects</code> function.  This function creates JavaScript objects to represent the scene, and we&#8217;ll come to it shortly, but before we do it&#8217;s also worth noting another change here; all of our previous <code>webGLStart</code> functions had a line to set up depth-testing:</p>
<pre>
    gl.enable(gl.DEPTH_TEST);
</pre>
<p>This has been removed for this example.  You will probably remember from last time that blending and depth-testing don&#8217;t play well together, and we use blending all the time in this example.  Depth-testing is off by default, so by removing this line from our usual boilerplate we&#8217;re all set.</p>
<p>The next big change is in the <code>animate</code> function.  Previously we used this to update the various global variables that represented the changing aspects of our scene &mdash; for example, the angle by which we should rotate a cube before drawing it.  The change we&#8217;ve made here is quite simple; instead of updating variables directly, we loop through all of the objects in our scene and tell each one to animate itself:</p>
<pre>
  var lastTime = 0;
  function animate() {
    var timeNow = new Date().getTime();
    if (lastTime != 0) {
      var elapsed = timeNow - lastTime;

      <span style="color: red">for (var i in stars) {
        stars[i].animate(elapsed);
      }</span>
    }
    lastTime = timeNow;

  }
</pre>
<p>Working our way up, <code>drawScene</code> comes next.  This has changed enough that I won&#8217;t highlight the specific changes; instead, we can go through it bit by bit.  Firstly:</p>
<pre>
  function drawScene() {
    gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

    mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0, pMatrix);
</pre>
<p>This is just our usual setup code, unchanged since lesson 1.</p>
<pre>
    gl.blendFunc(gl.SRC_ALPHA, gl.ONE);
    gl.enable(gl.BLEND);
</pre>
<p>Next, we switch on blending.  We&#8217;re using the same blending as we did in the last lesson; you will remember that this allows objects to &#8220;shine through&#8221; each other.  Usefully, it also means that black parts of an object are drawn as if they were transparent; to see how that works, take a look at the <a href="http://learningwebgl.com/blog/?p=859#blending-explanation">description of the blending function in the last lesson</a>.  What this means is that when we are drawing the stars that make up our scene, the black bits will seem transparent; indeed, the less bright a part of the star is, the more transparent it will seem.  And as the star is drawn using this texture:</p>
<p><img src="/lessons/lesson09/star.gif" alt="The star texture image" /></p>
<p>&#8230;this gets us just the effect we want.</p>
<p>On to the next part of the code:</p>
<pre>
    mat4.identity(mvMatrix);
    mat4.translate(mvMatrix, [0.0, 0.0, zoom]);
    mat4.rotate(mvMatrix, degToRad(tilt), [1.0, 0.0, 0.0]);
</pre>
<p>So, here we just move to the centre of the scene, and then zoom in appropriately.  We also tilt the scene around the X axis; the <code>zoom</code> and the <code>tilt</code> are still global variables controlled from the keyboard.  We&#8217;re now pretty much ready to draw the scene, so first we check whether the &#8220;twinkle&#8221; checkbox is checked:</p>
<pre>
    var twinkle = document.getElementById("twinkle").checked;
</pre>
<p>&#8230;and then, just as we did when animating them, we iterate over the list of stars and tell each one to draw itself.  We pass in the current tilt of the scene and the twinkle value.  We also tell it what the current &#8220;spin&#8221; is &mdash; this is used to make the stars spin around their centres as they orbit the centre of the scene.</p>
<pre>
    for (var i in stars) {
      stars[i].draw(tilt, spin, twinkle);
      spin += 0.1;
    }

  }
</pre>
<p>So, that&#8217;s <code>drawScene</code>.  We&#8217;ve now seen that the stars are clearly capable of drawing and animating themselves; the next code is the bit that creates them:</p>
<pre>
  var stars = [];
  function initWorldObjects() {
    var numStars = 50;

    for (var i=0; i < numStars; i++) {
      stars.push(new Star((i / numStars) * 5.0, i / numStars));
    }
  }
</pre>
<p>So, a simple loop creating 50 stars (you might want to try experimenting with larger or smaller numbers).  Each star is given a first parameter specifying a starting distance from the centre of the scene and a second specifying a speed to orbit the centre of the scene, both of which come from their position in the list.</p>
<p>The next code to look at is the class definition for the stars.  If you're not used to JavaScript, it will look really odd.  (If you know JavaScript well, <a href="#object-model-end">click here to skip my explanation of its object model</a>.)</p>
<p><span id="object-mode-start">JavaScript's object model</span> is very different to other languages'.  The way I've found it easiest to understand is that each object is created as a dictionary (or hashtable, or associative array) and then is turned into a fully-fledged object by putting values into it.  The object's fields are simply entries in the dictionary that map to values, and the methods are entries that map to functions.  Now, we add to that the fact that for single-word keys, the syntax <code>foo.bar</code> is a valid JavaScript shortcut for <code>foo["bar"]</code>, and you can see how you get syntax similar to other languages' from a very different starting point.</p>
<p>Next, when you're in any JavaScript function, there is an implicitly-bound variable called <code>this</code> which refers to the function's "owner".  For global functions this is a global per-page "window" object, but if you put the keyword <code>new</code> before it then it will be a brand-new object instead.  So, if you have  a function that sets <code>this.foo</code> to 1 and <code>this.bar</code> to a function, and then you make sure you always call it with the <code>new</code> keyword, it's basically the same as a constructor combined with a class definition.</p>
<p>Next, we can note that if a function is called using method invocation-like syntax (that is, <code>foo.bar()</code>), then <code>this</code> will be bound to the function's owner (<code>foo</code>), just as we'd expect, so the object's methods can do stuff to the object itself.</p>
<p>Finally, there's one special attribute associated with a function, <code>prototype</code>.  This is a dictionary of values that are associated with every object that is created using the <code>new</code> keyword with that function; this is a good way of setting values that will be the same for every object of that "class" &mdash; for example, methods.</p>
<p>[Thanks to <a href="http://learningwebgl.com/blog/?p=1008&#038;cpage=1#comment-312">murphy</a> and <a href="http://learningwebgl.com/blog/?p=1008&#038;cpage=1#comment-489">doug</a> in the comments and to <a href="http://devlicio.us/blogs/sergio_pereira/archive/2009/02/09/javascript-5-ways-to-call-a-function.aspx">this page by Sergio Pereira</a> for helping me correct the original version of that explanation.]</p>
<p><span id="object-model-end">Let's take a look at the function we write to define a <code>Star</code> object for this scene.</span></p>
<pre>
  function Star(startingDistance, rotationSpeed) {
    this.angle = 0;
    this.dist = startingDistance;
    this.rotationSpeed = rotationSpeed;

    // Set the colors to a starting value.
    this.randomiseColors();
  }
</pre>
<p>So, in the constructor function, the star is initialised with the values we provide and a starting angle of zero, and then a method is called.  The next step is to bind the methods to the <code>Star</code> function's associated prototype so that all new <code>Star</code>s have the same methods.  First,  the <code>draw</code> method:</p>
<pre>
  Star.prototype.draw = function(tilt, spin, twinkle) {
    mvPushMatrix();
 </pre>
<p>So, <code>draw</code> is defined to take the parameters we passed in to it back in the main <code>drawScene</code> function.   We start it off by pushing the current model-view matrix onto the matrix stack so that we can move around without fear of having side-effects elsewhere.</p>
<pre>
    // Move to the star's position
    mat4.rotate(mvMatrix, degToRad(this.angle), [0.0, 1.0, 0.0]);
    mat4.translate(mvMatrix, [this.dist, 0.0, 0.0]);
</pre>
<p>Next we rotate around the Y axis by the star's own angle, and move out by the star's distance from the centre.  This puts us in the correct position to draw the star.</p>
<pre>
    // Rotate back so that the star is facing the viewer
    mat4.rotate(mvMatrix, degToRad(-this.angle), [0.0, 1.0, 0.0]);
    mat4.rotate(mvMatrix, degToRad(-tilt), [1.0, 0.0, 0.0]);
</pre>
<p>These lines are required so that when we alter the tilt of the scene using the cursor keys, the stars still look right.  They are drawn as a 2D texture on a square, which looks right when we're looking at it straight on, but would just look like a line if we tilted the scene so that we were viewing it from the side.  For similar reasons, we also need to back out the rotation required to position the star.  When you "undo" rotations like this, you need to do so in the reverse of the order you did them in the first place, so first we undo the rotation from our positioning, and then the tilt (which was done in <code>drawScene</code>).</p>
<p>The next lines are to draw the star:</p>
<pre>
    if (twinkle) {
      // Draw a non-rotating star in the alternate "twinkling" color
      gl.uniform3f(shaderProgram.colorUniform, this.twinkleR, this.twinkleG, this.twinkleB);
      drawStar();
    }

    // All stars spin around the Z axis at the same rate
    mat4.rotate(mvMatrix, degToRad(spin), [0.0, 0.0, 1.0]);

    // Draw the star in its main color
    gl.uniform3f(shaderProgram.colorUniform, this.r, this.g, this.b);
    drawStar();
</pre>
<p>Let's ignore the code that's executed for the twinkling effect for a moment.  The star is drawn by first rotating around the Z axis by the spin that was passed in, so that it rotates around its own centre while it orbits the centre of the scene.  We then push the star's colour up to the graphics card in a shader uniform, and then call a global <code>drawStar</code> function (which we'll come to in a moment).</p>
<p>Now, what about that twinkling stuff?  Well, the star has two colours associated with it &mdash; its normal colour, and its "twinkling colour".  To make it twinkle, before we draw the star itself we draw a non-spinning star in a different colour.  This means that the two stars are blended together, making a nice bright colour, but also means that rays that come out of the first star to be drawn are stationary while the ones that come out of the second star are rotating, giving a nice effect.  That's our twinkling.</p>
<p>So, once we've drawn the star, we just pop our model-view matrix from the stack and we're done:</p>
<pre>
    mvPopMatrix();
  };
</pre>
<p>The next method we bind to the prototype is the one to animate the star:</p>
<pre>
  var effectiveFPMS = 60 / 1000;
  Star.prototype.animate = function(elapsedTime) {
</pre>
<p>As in the previous lessons, instead of just getting the scene to update as fast as it can, I've chosen to make it change at a steady pace for everyone, so people with faster computers get smoother animations and people with slower ones jerkier.  Now, I think that the numbers for the angular speed at which the stars orbit the centre of the scene and at which they move towards the centre were carefully calculated by NeHe, so rather than messing around with them I decided that it was best to assume that the numbers were calibrated for 60 frames per second and then use that and the <code>elapsedTime</code> (which you'll remember is the time between calls to the <code>animate</code> function) to scale the amount we move at each animation "tick" appropriately.  <code>elapsedTime</code> is in milliseconds, and so we want an effective frames-per-millisecond of 60 / 1000.  We put this into a global variable outside the <code>animate</code> method, so that it won't be recalculated every time we paint a star (thanks to deathy/Brainstorm for that <a href="http://learningwebgl.com/blog/?p=1008">suggestion</a>).</p>
<p>So, now we have this number we can adjust the star's <code>angle</code> &mdash; that is, how far around its orbit of the centre of the scene it is:</p>
<pre>
    this.angle += this.rotationSpeed * effectiveFPMS * elapsedTime;
</pre>
<p>...and we can adjust its distance from the centre, moving it out to the outside of the scene and resetting its colours to something random when it finally reaches the centre:</p>
<pre>
    // Decrease the distance, resetting the star to the outside of
    // the spiral if it's at the center.
    this.dist -= 0.01 * effectiveFPMS * elapsedTime;
    if (this.dist < 0.0) {
      this.dist += 5.0;
      this.randomiseColors();
    }

  };
</pre>
<p>The final bit of code that makes up the <code>Star</code>'s prototype is that code we saw used in the constructor and just now in the animation code to randomise its twinkling and non-twinkling colours:</p>
<pre>
  Star.prototype.randomiseColors = function() {
    // Give the star a random color for normal
    // circumstances...
    this.r = Math.random();
    this.g = Math.random();
    this.b = Math.random();

    // When the star is twinkling, we draw it twice, once
    // in the color below (not spinning) and then once in the
    // main color defined above.
    this.twinkleR = Math.random();
    this.twinkleG = Math.random();
    this.twinkleB = Math.random();
  };
</pre>
<p>...and we're done with the star's prototype.  So, that's how a star object is created, complete with methods to draw and animate it.  Now, just above these functions, you can see the (rather dull) code that draws the star: it just draws a square in a manner that will be familiar from the first lesson, using an appropriate texture and vertex position/texture coordinate buffers:</p>
<pre>
  function drawStar() {
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, starTexture);
    gl.uniform1i(shaderProgram.samplerUniform, 0);

    gl.bindBuffer(gl.ARRAY_BUFFER, starVertexTextureCoordBuffer);
    gl.vertexAttribPointer(shaderProgram.textureCoordAttribute, starVertexTextureCoordBuffer.itemSize, gl.FLOAT, false, 0, 0);

    gl.bindBuffer(gl.ARRAY_BUFFER, starVertexPositionBuffer);
    gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, starVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);

    setMatrixUniforms();
    gl.drawArrays(gl.TRIANGLE_STRIP, 0, starVertexPositionBuffer.numItems);
}
</pre>
<p>A little further up, you can see <code>initBuffers</code>, which sets up those vertex position and texture coordinate buffers, and then the appropriate code in <code>handleKeys</code> to manipulate the <code>zoom</code> and <code>tilt</code> functions when the user presses the up/down cursor keys or the <code>Page Up</code>/<code>Page Down</code> keys.  A little further up again, and you will see the <code>initTexture</code> and <code>handleLoadedTexture</code> functions have been updated to load the new texture.  All of that is so simple that I won't bore you by describing it <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
<p>Let's just go right up to the shaders, where you can see the last change that was required for this lesson.  All of the lighting-related stuff has been removed from the vertex shader, which is now just the same as it was for <a href="http://learningwebgl.com/blog/?p=507">lesson 5</a>.  The fragment shader is a little bit more interesting:</p>
<pre>
  precision mediump float;

  varying vec2 vTextureCoord;

  uniform sampler2D uSampler;

  uniform vec3 uColor;

  void main(void) {
    vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
    gl_FragColor = textureColor * vec4(uColor, 1.0);
  }
</pre>
<p>...but not that much more interesting <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' />   All we're doing is picking up that colour uniform that was pushed up here by the code in the star's <code>draw</code> method and using it to tint the texture, which is monochrome.  This means that our stars appear in the appropriate colour.</p>
<p>And that's it!  Now you know all there is to learn from this lesson: how to create JavaScript objects to represent things in your scene, and to give them methods that allow them to be separately animated and drawn.</p>
<p>Next time, we'll show how to load up a scene from a simple file, and take a look at how you can have a camera moving through it, combining these to make kind of nano-Doom <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
<p><span style="float: left; padding: 0px 20px 0px 0px;"><a href="http://learningwebgl.com/blog/?p=859">&lt;&lt; Lesson 8</a></span><span style="float: right; padding: 0px 20px 0px 0px;"><a href="http://learningwebgl.com/blog/?p=1067">Lesson 10 &gt;&gt;</a></span><br/></p>
<p><em>Acknowledgments: As always, I'm deeply in debt to <a href="http://nehe.gamedev.net/">NeHe</a> for his <a href="http://nehe.gamedev.net/data/lessons/lesson.asp?lesson=09">OpenGL tutorial</a> for the script for this lesson.</em></p>
															</div>
							<div class="postmeta">Posted in <a href="http://learningwebgl.com/blog/?cat=1" title="View all posts in Uncategorized" rel="category">Uncategorized</a> |  </div>
						
							<div class="navigation clearfix">
								<div class="alignleft">&laquo; <a href="http://learningwebgl.com/blog/?p=1022" rel="prev">A happy Thanksgiving to all</a></div>
								<div class="alignright"><a href="http://learningwebgl.com/blog/?p=1010" rel="next">Debugging tip in Minefield</a> &raquo;</div>
							</div>
							
															You can <a href="#respond">leave a response</a>, or <a href="http://learningwebgl.com/blog/wp-trackback.php?p=1008" rel="trackback">trackback</a> from your own site.
	
													</div><!--/post-1008-->
						
				
<!-- You can start editing here. -->

	<h3 id="comments">36 Responses to &#8220;WebGL Lesson 9 – improving the code structure with lots of moving objects&#8221;</h3>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1" id="comment-7162">
				<div id="div-comment-7162" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/4995c7ce9523ce00dea01362cb976196?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">murphy</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7162">November 27, 2009 at 12:48 am</a></div>

		<p>That was a nice lesson, I can see that Christmas is approaching <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
<p>Your explanations about &#8220;this&#8221; are not fully correct though. &#8220;this&#8221; is not pointing to the function, but to the receiver of the function call, which is determined by the calling statement obj.fun(). The function isn&#8217;t copied.</p>
<p>By the way, you could also hide most of the members of Star by using the closure scope; only draw() and animate() need to be visible from the outside. Here&#8217;s a patch: <a href="http://pastie.textmate.org/716668" rel="nofollow">http://pastie.textmate.org/716668</a>. But maybe I just like closure variables more than member variables <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7163">
				<div id="div-comment-7163" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/4995c7ce9523ce00dea01362cb976196?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">murphy</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7163">November 27, 2009 at 12:54 am</a></div>

		<p>Oh, and as for nano-Doom: I am very excited about that! We don&#8217;t get any weapons yet, do we?</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7164">
				<div id="div-comment-7164" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/6c399f7438f4bc2cc3d2b6b3507e8897?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn"><a href='http://www.paulbrunt.co.uk' rel='external nofollow' class='url'>Paul</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7164">November 27, 2009 at 8:43 am</a></div>

		<p>First off this is an excellent addition to a brilliant resource. I&#8217;ve learned so much from this site in the last couple of weeks. I have discovered one little issue with the code which shows up in several tutorials. It isn&#8217;t effecting anything yet, but the following line may cause you trouble down the line:</p>
<p>    gl.uniform1f(gl.getUniformLocation(shaderProgram, &#8220;uSampler&#8221;), 0);</p>
<p>This works fine when you only have one texture in your shader; but, if you want to use more then one, it won&#8217;t complain or error, just not work as it&#8217;s expecting an int not a float:</p>
<p>    gl.uniform1i(gl.getUniformLocation(shaderProgram, &#8220;uSampler&#8221;), 0);</p>
<p>Keep up the great work.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7165">
				<div id="div-comment-7165" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7165">November 27, 2009 at 2:05 pm</a></div>

		<p>@murphy &#8212; thanks for explaining that!  I&#8217;ll read up a little on JavaScript functions and receivers and fix the description appropriately.  Unfortunately the nano-Doom is a bit too primitive for weapons, or indeed monsters.  It does have a bobbing-head effect, though <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
<p>@Paul &#8212; glad you like the posts!  That&#8217;s a great point about the texture uniforms, I&#8217;ve tweaked this and the previous tutorials so that future readers don&#8217;t get caught out.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7166">
				<div id="div-comment-7166" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7166">November 27, 2009 at 3:17 pm</a></div>

		<p>@murphy &#8212; OK, hopefully that&#8217;s better now!  I&#8217;ve not put in the use of the closure scope, I think I need to think a bit more about that before using it &#8212; to a Python guy it looks very odd <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7167">
				<div id="div-comment-7167" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/4995c7ce9523ce00dea01362cb976196?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">murphy</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7167">November 27, 2009 at 5:32 pm</a></div>

		<p>Yes, I see&#8230;you certainly wouldn&#8217;t do that in Python! I just happen to play around with closures a lot, and there are fascinating things you can do with them &#8211; but this is a WebGL tutorial, not a functional programming tutorial <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  Keep up the great work!</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7168">
				<div id="div-comment-7168" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/c2fd1bb7bf3c407790f1fe717d244476?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">doug</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7168">December 17, 2009 at 8:12 am</a></div>

		<p>It&#8217;s not much of an issue with only 50 stars, but your code is creating a new instance of the draw and animate functions per star instance.  They&#8217;re all the same, so you don&#8217;t need to have separate copies per star.  Instead of creating the draw and animate functions in the constructor and assigning them to fields of the newly-constructed instance, you should create and assign them to the prototype, so that all Stars can use the same ones:</p>
<p>function Star(startingDistance, rotationSpeed) {<br />
    this.angle = 0;<br />
    this.dist = startingDistance;<br />
    this.rotationSpeed = rotationSpeed;<br />
};</p>
<p>Star.prototype.draw = new function(tilt, spin, twinkle) { &#8230; }</p>
<p>Star.prototype.animate = new function(elapsedTime) { &#8230; }</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7169">
				<div id="div-comment-7169" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7169">December 17, 2009 at 12:40 pm</a></div>

		<p>doug &#8212; that sounds like a good plan, I don&#8217;t want to get people new to JavaScript into bad habits.  I&#8217;ll update the lesson.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7170">
				<div id="div-comment-7170" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/68f0abd39a2b3b8555ca7e689b1f122c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">Hao</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7170">January 17, 2010 at 4:20 pm</a></div>

		<p>The zoom in/out keyboard mapping seems to be inconsistent with the previous lessons. It may be nice to keep the same mapping throughout&#8230;</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7171">
				<div id="div-comment-7171" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7171">January 18, 2010 at 3:42 pm</a></div>

		<p>Good point, I&#8217;ll fix that.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7172">
				<div id="div-comment-7172" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7172">January 25, 2010 at 6:35 pm</a></div>

		<p>Fixed.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7173">
				<div id="div-comment-7173" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/706e4d71c455e5381d55703241e2bb5f?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">Neppord</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7173">May 3, 2010 at 2:08 pm</a></div>

		<p>Hi the WebGL version seems to be non working on newest webkitt nightly. it starts but renders incorrectly. It appears to be at first, but the cpu dose not seem to be overloaded. Have something changed in the way WebGL renders scenes since this lesson was made? I remember that i it didn&#8217;t lag when it was new.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7174">
				<div id="div-comment-7174" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7174">May 6, 2010 at 6:29 pm</a></div>

		<p>@Neppord &#8212; still looks OK for me on Minefield and Chrome on Windows.  What way is it going wrong for you with WebKit?</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7175">
				<div id="div-comment-7175" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/706e4d71c455e5381d55703241e2bb5f?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">Neppord</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7175">July 22, 2010 at 4:02 pm</a></div>

		<p>Now its working. maybe new ver of webkit.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7176">
				<div id="div-comment-7176" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7176">July 22, 2010 at 7:28 pm</a></div>

		<p>Hmm, weird!  Perhaps there was just a bad build.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7177">
				<div id="div-comment-7177" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/6fc90f4e1820c1768601c14c0896904b?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">m.sirin</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7177">September 1, 2010 at 3:33 pm</a></div>

		<p>hi giles!<br />
I&#8217;m using objects that have almost the same structure as yours. for each instantiated object (for example spheres) a buffer is created via createBuffer() and data is appended,too then it is stored as a object attribute. but this is only for the first time of drawing this object, then when the object-draw-function is called at least a second time the buffer is just used as usual with bindBuffer etc. Each object has a drawing method that contains such things like mvPushMatrix, drawArrays (&#8230;) and mvPopMatrix. In case the object is called let&#8217;s say 250 times the performance is really bad (something like 1-2 fps). removing all the matrix-operations mvPopMatrix, mvTranslate, mvRotate,PushMatrix helps a lot improving performance. also fps are increased when removing drawArrays. but of course i need these things to run the stuff..<br />
so the speed-killers are : mv-Matrix-Functions (or is it the slow matrix operations?), drawArrays (drawElements) and i think bindBuffer,too.</p>
<p>what would you suggest to do for get rid of this performance-problem?</p>
<p>And yes, it is important to use such independent objects, because I want to do stuff like transform a single object or change color of a single certain object etc.</p>
<p>I look forward for your answer <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7178">
				<div id="div-comment-7178" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/6fc90f4e1820c1768601c14c0896904b?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">m.sirin</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7178">September 6, 2010 at 3:19 pm</a></div>

		<p>hi, now i tried another matrix-framework which you mentioned earlier. it is tojiros glMatrix-0.9.4 and is really much faster than sylvester&#8217;s matrices. so my above mentioned mvMatrix performance problem is solved. but still remaining is the drawArray issue..i&#8217;ll look around to find a solution <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
<p>bye</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7179">
				<div id="div-comment-7179" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/4712f9b0e63f56ad952ad387eaa23b9c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">vavo</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7179">November 15, 2010 at 2:05 pm</a></div>

		<p>var distances = []</p>
<p>This varible is never called. The program works without this line.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7180">
				<div id="div-comment-7180" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7180">December 5, 2010 at 7:02 pm</a></div>

		<p>@m.sirin &#8212; for some reason I never saw your comments, sorry for not replying!  Thanks for the suggestion of using Tojiro&#8217;s matrix library, I might port the lessons over to it.  re: drawArrays &#8212; not sure how you can work around that problem&#8230;</p>
<p>@vavo &#8212; thanks for spotting that, I&#8217;ll remove it.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7181">
				<div id="div-comment-7181" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/241aa8bb2a154108277e22ed03508ab0?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn"><a href='http://www.droidnova.com' rel='external nofollow' class='url'>WarrenFaith</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7181">January 5, 2011 at 3:00 pm</a></div>

		<p>Was a bit shocked at the beginning because my performance was multiple times slower than you sample. This sample was the first time I recognized that the debugging option from khronos ( <a href="http://www.khronos.org/webgl/wiki/Debugging" rel="nofollow">http://www.khronos.org/webgl/wiki/Debugging</a> ) has a huge impact on the performance&#8230; thought it wouldn&#8217;t be so much&#8230;</p>
<p>I also thought that &#8220;improving the code structure&#8221; will be a bit more improved&#8230; but I guess I am just fastidious (is this the right word?!) by Java and not used to the JavaScript way of programming&#8230;</p>
<p>Nice sample, thought it will be colored light instead of blended textures at first glance&#8230;</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7182">
				<div id="div-comment-7182" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7182">January 10, 2011 at 11:22 pm</a></div>

		<p>That does sound like a big hit from the debugger!  That said, this demo does hit the GPU quite frequently, and presumably the problem is a per-call cost.</p>
<p>Re: improving the code structure &#8212; some of it might be differences in what&#8217;s regarded as good structure in JavaScript versus what&#8217;s regarded as good in Java.  Neither&#8217;s necessarily better than the other (and I speak as someone who coded very fastidious [yup, good word!] Java from 1995-2005 and then even-more-fastidious Python from 2005-2011), but the natural &#8220;idiomatic&#8221; style is different in a strongly-typed class-based language versus a dynamically-typed primarily functional language with non-class-based OO support.  OTOH some of the stuff that looks like ill-structured code in this might just be me writing bad code, it&#8217;s been known to happen <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' />   If you get a chance to point out any bits that look particularly messy I&#8217;d be glad to hear about them.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7183">
				<div id="div-comment-7183" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/a33ecf87824407d0e01bf86a92857f7a?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">deathy/Brainstorm</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7183">February 13, 2011 at 10:28 pm</a></div>

		<p>Minor suggestion for performance:</p>
<p>effectiveFPMS is calculated for every single star every frame.  This is a pretty static value and could be set as a global value so that it only gets calculated once.</p>
<p>It&#8217;s true that it&#8217;s something that won&#8217;t likely get noticed on modern hardware, but these things will still add up and thinking about code optimization is going to be more important with WebGL than other modern languages just because of its nature.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7184">
				<div id="div-comment-7184" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7184">February 16, 2011 at 8:31 pm</a></div>

		<p>Thanks, deathy/Brainstorm &#8212; I&#8217;ll make that change soon.  [UPDATE: done]</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7185">
				<div id="div-comment-7185" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/ad42d98774abaa0abb73dc8dcccf4015?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">mikekidder</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7185">March 1, 2011 at 4:48 am</a></div>

		<p>Nice to see the continual improvement on these WebGL tutorial/demos.  Really great stuff and learning a lot.  Thank you very much for these.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7186">
				<div id="div-comment-7186" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7186">March 5, 2011 at 7:24 pm</a></div>

		<p>@mikekidder &#8212; glad you like them!  The one thing I want to avoid is having these lessons get out of date and teach people bad practices.  There&#8217;s enough terrible JavaScript out there on the web already without me making things worse <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_wink.gif' alt=';-)' class='wp-smiley' /> </p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7187">
				<div id="div-comment-7187" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/94579b42aa99e9e7983d016ac95e8f74?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">magicSuper</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7187">March 8, 2011 at 1:46 am</a></div>

		<p>Hi~<br />
I init 15 squares(like the stars,using your way <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  ) and give them different texture. The code is like:</p>
<p>var texture;<br />
var textureArray = [];</p>
<p>for(var i =0;i&lt;15;i++){<br />
  texture = g1.createTexture();<br />
  /*<br />
    init&#8230;<br />
  */<br />
  textureArray.push(texture);<br />
}</p>
<p>when it&#039;s done, I find that the textureArray[0]~textureArray[13]&#039;s image is none,just the last one&#039;s image is in.</p>
<p>And I tried some stupid ways like this:<br />
var texture1 ~ texture15;(and init them )<br />
then all the image is in the array.</p>
<p>It&#039;s confused that why the images have gone&#8230;..</p>
<p>It&#039;s different with the java objects? I know in Java,the first one does well. Sorry to bother you.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7188">
				<div id="div-comment-7188" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7188">March 9, 2011 at 7:41 pm</a></div>

		<p>Hi magicSuper &#8212; that sounds like it would work, not sure why it doesn&#8217;t.  Could you copy and paste the exact code, including the bit in the &#8220;init&#8221; section you&#8217;ve done as a comment?</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7189">
				<div id="div-comment-7189" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/94579b42aa99e9e7983d016ac95e8f74?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">magicSuper</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7189">March 10, 2011 at 10:12 am</a></div>

		<pre>
    var neheTexture =[];

    function initTexture() {
    	var texture;
        for(var i =0;i&lt;30;i++){
            texture = gl.createTexture();
            texture.image = new Image();
            texture.image.onload = function () {
            handleLoadedTexture(texture)
        }

        texture.image.src =&quot;&quot;+(i+1)+&quot;.jpg&quot;;
        //alert(texture.image.src);
        neheTexture.push(texture);

        }
    }
</pre>
<p>[EDITED by giles to add "pre" tags to make it readable]</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7190">
				<div id="div-comment-7190" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/2872c4aad0f3cfdb6421c36527fb868c?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">giles</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7190">March 29, 2011 at 3:18 pm</a></div>

		<p>Very strange.  I would certainly expect that to work.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7191">
				<div id="div-comment-7191" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/b712e7ed1fecbe8778c012d18678f4ba?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">simpleq</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7191">August 21, 2011 at 1:29 pm</a></div>

		<p>Hi! First of all, thank you for these wonderful lessons.</p>
<p>I am trying to change the code to make 50 red cubes that do not rotate and with no keyboard input. This seems like it should be simple, but right now all I&#8217;m getting is the black rectangle with no cubes. I think maybe the problem is with how I am putting in the colors. If you have a chance to take a look at my code, that would be great! I&#8217;ll paste the parts I am uncertain about. InitGL is the same as always, as is getShader. Sorry this is long&#8230;</p>
<p>    #ifdef GL_ES<br />
    precision highp float;<br />
    #endif</p>
<p>    uniform  vec3 uColor;</p>
<p>    void main(void) {<br />
        gl_FragColor = vec4(uColor, 1.0);<br />
    }</p>
<p>    attribute vec3 aVertexPosition;</p>
<p>    uniform mat4 uMVMatrix;<br />
    uniform mat4 uPMatrix;</p>
<p>    void main(void) {<br />
        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);<br />
    }</p>
<p>var shaderProgram;</p>
<p>    function initShaders() {<br />
        var fragmentShader = getShader(gl, &#8220;shader-fs&#8221;);<br />
        var vertexShader = getShader(gl, &#8220;shader-vs&#8221;);</p>
<p>        shaderProgram = gl.createProgram();<br />
        gl.attachShader(shaderProgram, vertexShader);<br />
        gl.attachShader(shaderProgram, fragmentShader);<br />
        gl.linkProgram(shaderProgram);</p>
<p>        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {<br />
            alert(&#8220;Could not initialise shaders&#8221;);<br />
        }</p>
<p>        gl.useProgram(shaderProgram);</p>
<p>        shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, &#8220;aVertexPosition&#8221;);<br />
        gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);</p>
<p>        shaderProgram.pMatrixUniform = gl.getUniformLocation(shaderProgram, &#8220;uPMatrix&#8221;);<br />
        shaderProgram.mvMatrixUniform = gl.getUniformLocation(shaderProgram, &#8220;uMVMatrix&#8221;);<br />
        shaderProgram.colorUniform = gl.getUniformLocation(shaderProgram, &#8220;uColor&#8221;);<br />
    }</p>
<p> var starVertexPositionBuffer;</p>
<p>    function initBuffers() {<br />
        starVertexPositionBuffer = gl.createBuffer();<br />
        gl.bindBuffer(gl.ARRAY_BUFFER, starVertexPositionBuffer);<br />
        var vertices = [<br />
            // Front face<br />
             0.0,  1.0,  0.0,<br />
            -1.0, -1.0,  1.0,<br />
             1.0, -1.0,  1.0,</p>
<p>            // Right face<br />
             0.0,  1.0,  0.0,<br />
             1.0, -1.0,  1.0,<br />
             1.0, -1.0, -1.0,</p>
<p>            // Back face<br />
             0.0,  1.0,  0.0,<br />
             1.0, -1.0, -1.0,<br />
            -1.0, -1.0, -1.0,</p>
<p>            // Left face<br />
             0.0,  1.0,  0.0,<br />
            -1.0, -1.0, -1.0,<br />
            -1.0, -1.0,  1.0<br />
        ];<br />
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);<br />
        starVertexPositionBuffer.itemSize = 3;<br />
        starVertexPositionBuffer.numItems = 12;<br />
     }</p>
<p> function drawStar() {<br />
        gl.bindBuffer(gl.ARRAY_BUFFER, starVertexPositionBuffer);<br />
        gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute, starVertexPositionBuffer.itemSize, gl.FLOAT, false, 0, 0);</p>
<p>        setMatrixUniforms();<br />
        gl.drawArrays(gl.TRIANGLE_STRIP, 0, cubeVertexPositionBuffer.numItems);<br />
    }</p>
<p> function Star(startingDistance) {<br />
        this.angle = 0;<br />
        this.dist = startingDistance;<br />
        // Set the colors to a starting value.<br />
        this.randomiseColors();<br />
    }</p>
<p>    Star.prototype.draw = function (tilt) {<br />
        mvPushMatrix();</p>
<p>        // Move to the star&#8217;s position<br />
        mat4.translate(mvMatrix, [this.dist, 0.0, 0.0]);</p>
<p>        // Draw the star in its main color<br />
        gl.uniform3f(shaderProgram.colorUniform, this.r, this.g, this.b);</p>
<p>       drawStar()</p>
<p>        mvPopMatrix();<br />
    };</p>
<p>    var stars = [];<br />
     function initWorldObjects() {<br />
        var numStars = 50;</p>
<p>        for (var i=0; i &lt; numStars; i++) {<br />
            stars.push(new Star((i / numStars) * 5.0));<br />
        }<br />
    }</p>
<p>    function drawScene() {<br />
        gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);<br />
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);</p>
<p>        mat4.perspective(45, gl.viewportWidth / gl.viewportHeight, 0.1, 100.0, pMatrix);</p>
<p>        mat4.identity(mvMatrix);</p>
<p>        for (var i in stars) {<br />
            stars[i].draw();<br />
        }</p>
<p>    }</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7192">
				<div id="div-comment-7192" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/11da03b490bfb78ef5858d36e3cb5168?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn"><a href='http://mgiulio.github.com' rel='external nofollow' class='url'>mgiulio</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7192">November 7, 2011 at 4:47 pm</a></div>

		<p>Hi, thanks for these lessons.<br />
When I decided to reuse my past OpenGL experiences with WebGL, at first I was disappointed for the mandatory use of shaders(I only used the fixed pipeline), but then this site helped a lot. Thanks again.</p>
<p>About this lesson: at line 347,I think you forgot to remove the depth buffer flag:</p>
<p>gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);</p>
<p>Bye.</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="pingback odd alt thread-odd thread-alt depth-1" id="comment-7193">
				<div id="div-comment-7193" class="comment-body">
				<div class="comment-author vcard">
				<cite class="fn"><a href='http://www.jlabstudio.com/webgl/2011/11/webgl-tutorial-9-mejorando-la-estructura-del-codigo/' rel='external nofollow' class='url'>WebGL Tutorial 9 &#8211; Mejorando la estructura del código &middot; Experimentando en la web</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7193">November 11, 2011 at 11:37 am</a></div>

		<p>[...] tutorial de la serie Aprende webGL. Es una traducción no literal de su respectivo tutorial en Learning webGL, que a su vez está basada en el capítulo 9 del tutorial sobre openGL de NeHe. En él mostraremos [...]</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7194">
				<div id="div-comment-7194" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/dd5bc4a0dde576079b0961827b2f9028?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn"><a href='http://None' rel='external nofollow' class='url'>Maruthi</a></cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7194">January 4, 2012 at 11:59 am</a></div>

		<p>Sorry if I missed something in the draw.</p>
<p>We need the stars to spin about their Z.</p>
<p>However looks like the code for draw stars first translates the stars along X and then rotates them about Z. Shouldnt it be the other way round?</p>
<p>i.e, spin(rotate) the star (which is at the origin) about its Z and then translate the star along X..</p>
<p>Thanks,<br />
Maruthi</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-7195">
				<div id="div-comment-7195" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/c78c500a1e30a6cf246488e92e6e72bb?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">Zani</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7195">January 15, 2012 at 4:08 pm</a></div>

		<p>I fist want to thank you for the great tutorials.</p>
<p>I have a little problem. How can I make the examples with texture work locally? I have my own gif pictures which I use in the code, but it still doesn&#8217;t work. Thank you in advance&#8230;</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment even thread-even depth-1" id="comment-7196">
				<div id="div-comment-7196" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/c78c500a1e30a6cf246488e92e6e72bb?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">Zani</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-7196">January 15, 2012 at 4:11 pm</a></div>

		<p>first*** typo&#8230; I&#8217;m so sorry</p>

		<div class="reply">
				</div>
				</div>
		</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-71544">
				<div id="div-comment-71544" class="comment-body">
				<div class="comment-author vcard">
		<img alt='' src='http://www.gravatar.com/avatar/34440fcb19ed8db7e67528eaeb6003e6?s=40&amp;d=http%3A%2F%2Fwww.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40&amp;r=G' class='avatar avatar-40 photo' height='40' width='40' />		<cite class="fn">D3</cite> <span class="says">says:</span>		</div>

		<div class="comment-meta commentmetadata"><a href="http://learningwebgl.com/blog/?p=1008&amp;cpage=1#comment-71544">July 18, 2013 at 9:27 am</a></div>

		<p>Naming a function &#8220;randomiseColors&#8221; is so offensive to my sense of language as you have mixed both English and American spellings!!</p>
<p>Just pick one. <img src='http://learningwebgl.com/blog/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>

		<div class="reply">
				</div>
				</div>
		</li>
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
 


<div id="respond">

<h3>Leave a Reply</h3>

<div class="cancel-comment-reply">
	<small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/?p=1008#respond" style="display:none;">Click here to cancel reply.</a></small>
</div>


<form action="http://learningwebgl.com/blog/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" aria-required='true' />
<label for="author"><small>Name (required)</small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" aria-required='true' />
<label for="email"><small>Mail (will not be published) (required)</small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3" />
<label for="url"><small>Website</small></label></p>


<!--<p><small><strong>XHTML:</strong> You can use these tags: <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </code></small></p>-->

<p><textarea name="comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea></p>

<p><input name="submit" type="submit" id="submit" tabindex="5" value="Submit Comment" />
<input type='hidden' name='comment_post_ID' value='1008' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p>

</form>

</div>

				
							
							</div>
			</div>
        <div class="span-8 last">
    <div id="subscriptions">
        <a href="http://learningwebgl.com/blog/?feed=rss2"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/rss.png" alt="Subscribe to RSS Feed" title="Subscribe to RSS Feed" /></a>		
		<a href="https://twitter.com/learningwebgl" title="Follow Learning WebGL on Twitter"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/twitter.png" title="Follow Learning WebGL on Twitter" alt="Follow Learning WebGL on Twitter"  /></a>    </div>
	<div id="sidebar">
        <ul>
            <li id="search">
				 
<div class="searchlayout">
    <form method="get" id="searchform" action="http://learningwebgl.com/blog/"> 
        <input type="text" value="Search" 
            name="s" id="s"  onblur="if (this.value == '')  {this.value = 'Search';}"  
            onfocus="if (this.value == 'Search') {this.value = '';}" />
        <input type="image" src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/search.gif" style="border:0; vertical-align: top;" /> 
    </form>
</div>			</li>
        </ul>
            			<div class="addthis_toolbox">   
    			    <div class="custom_images">
    			            <a class="addthis_button_twitter"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/socialicons/twitter.png" width="32" height="32" alt="Twitter" /></a>
    			            <a class="addthis_button_delicious"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/socialicons/delicious.png" width="32" height="32" alt="Delicious" /></a>
    			            <a class="addthis_button_facebook"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/socialicons/facebook.png" width="32" height="32" alt="Facebook" /></a>
    			            <a class="addthis_button_digg"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/socialicons/digg.png" width="32" height="32" alt="Digg" /></a>
    			            <a class="addthis_button_stumbleupon"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/socialicons/stumbleupon.png" width="32" height="32" alt="Stumbleupon" /></a>
    			            <a class="addthis_button_favorites"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/socialicons/favorites.png" width="32" height="32" alt="Favorites" /></a>
    			            <a class="addthis_button_more"><img src="http://learningwebgl.com/blog/wp-content/themes/modern-style/images/socialicons/more.png" width="32" height="32" alt="More" /></a>
    			    </div>
    			    <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js?pub=xa-4a65e1d93cd75e94"></script>
    			</div>
    					        
		<ul>
		  <li id="text-3" class="widget widget_text"><h2 class="widgettitle">Our Sponsors</h2>			<div class="textwidget">    <div style="margin-left: 10px; margin-top: 20px; width: 170px">
    <a href="http://web.chemdoodle.com/" target="_blank"><img src="/ads/chemdoodle.gif" ></a>
    <p>
    Open-source <b>HTML5</b> solutions for the physical and life sciences.
    <a style="font-decoration: underline; color: #880000;" href="http://web.chemdoodle.com/">Read more...</a>
    </div>

<iframe src="http://cdn.oreillystatic.com/widgets/author/217.html" height="400px" width="200px" scrolling="no" frameborder="0"></iframe>
    <hr/>

    <div style="margin-left: 10px; margin-top: 20px; width: 170px;">
    <a href="http://www.pythonanywhere.com/"><img src="/ads/pythonanywhere.gif"></a>

    <p>
    <a href="http://www.pythonanywhere.com">A Python online IDE and web hosting environment</a>. 
    <a style="font-decoration: underline; color: #880000;" href="http://www.pythonanywhere.com/">Read more...</a>
    <br/>
    <br/>
    Interested in advertising on Learning WebGL? <a style="font-decoration: underline; color: #880000;" href="/cdn-cgi/l/email-protection#e5919584978c968ca58288848c89cb868a88">Drop me a line.</a>
    </div></div>
		</li>		<li id="recent-posts-3" class="widget widget_recent_entries">		<h2 class="widgettitle">Recent Posts</h2>		<ul>
				<li><a href="http://learningwebgl.com/blog/?p=6635" title="2014: The Year in Review">2014: The Year in Review </a></li>
				<li><a href="http://learningwebgl.com/blog/?p=6617" title="WebGL around the net, 11 December 2014">WebGL around the net, 11 December 2014 </a></li>
				<li><a href="http://learningwebgl.com/blog/?p=6613" title="Crowdfunding Update">Crowdfunding Update </a></li>
				<li><a href="http://learningwebgl.com/blog/?p=6599" title="WebGL around the net, 4 December 2014">WebGL around the net, 4 December 2014 </a></li>
				<li><a href="http://learningwebgl.com/blog/?p=6585" title="WebGL around the net, 25 November 2014">WebGL around the net, 25 November 2014 </a></li>
				</ul>
		</li>		<li id="recent-comments-3" class="widget widget_recent_comments">			<h2 class="widgettitle">Recent Comments</h2>			<ul id="recentcomments"><li class="recentcomments"><a href='http://www.pcprogramming.com' rel='external nofollow' class='url'>John Davis</a> on <a href="http://learningwebgl.com/blog/?p=6585&#038;cpage=1#comment-3652744">WebGL around the net, 25 November 2014</a></li><li class="recentcomments"><a href='http://www.pcprogramming.com' rel='external nofollow' class='url'>John Davis</a> on <a href="http://learningwebgl.com/blog/?p=6575&#038;cpage=1#comment-3618905">WebGL around the net, 20 November 2014</a></li><li class="recentcomments">jinit on <a href="http://learningwebgl.com/blog/?page_id=2&#038;cpage=1#comment-3313484">About</a></li><li class="recentcomments">Dethraid on <a href="http://learningwebgl.com/blog/?p=507&#038;cpage=3#comment-2792181">WebGL Lesson 5 – introducing textures</a></li><li class="recentcomments">Man on <a href="http://learningwebgl.com/blog/?p=6443&#038;cpage=1#comment-2572225">WebGL around the net, 7 July 2014</a></li></ul>
		</li><li id="linkcat-2" class="widget widget_links"><h2 class="widgettitle">Blogroll</h2>
	<ul class='xoxo blogroll'>
<li><a href="http://blog.tojicode.com/" title="Brandon Jones&#8217; Blog" target="_blank">Brandon Jones</a></li>
<li><a href="http://www.gilesthomas.com/" title="Giles Thomas&#8217; Personal Blog" target="_blank">Giles Thomas</a></li>
<li><a href="http://games.greggman.com/game/" title="Gregg Tavares&#8217; Blog" target="_blank">Gregg Tavares</a></li>
<li><a href="http://www.learnopengles.com/" title="Learn OpenGL ES" target="_blank">Learn OpenGL ES</a></li>
<li><a href="http://learningthreejs.com/" title="Learning Three.js Blog" target="_blank">Learning Three.js</a></li>
<li><a href="http://nehe.gamedev.net/" title="NeHe OpenGL Tutorials" target="_blank">NeHe OpenGL</a></li>
<li><a href="http://www.paulbrunt.co.uk/" title="Paul Brunt&#8217;s Blog" target="_blank">Paul Brunt</a></li>
<li><a href="http://pl4n3.blogspot.com/" title="PL4N3S WORLD Blog" target="_blank">PL4N3S WORLD</a></li>
<li><a href="http://www.rozengain.com/blog/" title="Rozengain" target="_blank">Rozengain</a></li>
<li><a href="http://www.tonyparisi.com/" title="Tony Parisi&#8217;s Personal Blog" target="_blank">Tony Parisi</a></li>
<li><a href="http://www.webgl.com/" title="WebGL Demos and Links" target="_blank">WebGL.com</a></li>

	</ul>
</li>
<li id="archives-3" class="widget widget_archive"><h2 class="widgettitle">Archives</h2>		<ul>
			<li><a href='http://learningwebgl.com/blog/?m=201501' title='January 2015'>January 2015</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201412' title='December 2014'>December 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201411' title='November 2014'>November 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201410' title='October 2014'>October 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201409' title='September 2014'>September 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201408' title='August 2014'>August 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201407' title='July 2014'>July 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201406' title='June 2014'>June 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201405' title='May 2014'>May 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201404' title='April 2014'>April 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201403' title='March 2014'>March 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201402' title='February 2014'>February 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201401' title='January 2014'>January 2014</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201312' title='December 2013'>December 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201311' title='November 2013'>November 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201310' title='October 2013'>October 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201309' title='September 2013'>September 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201308' title='August 2013'>August 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201307' title='July 2013'>July 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201306' title='June 2013'>June 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201305' title='May 2013'>May 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201304' title='April 2013'>April 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201303' title='March 2013'>March 2013</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201212' title='December 2012'>December 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201211' title='November 2012'>November 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201210' title='October 2012'>October 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201209' title='September 2012'>September 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201208' title='August 2012'>August 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201207' title='July 2012'>July 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201206' title='June 2012'>June 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201205' title='May 2012'>May 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201204' title='April 2012'>April 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201203' title='March 2012'>March 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201202' title='February 2012'>February 2012</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201112' title='December 2011'>December 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201111' title='November 2011'>November 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201110' title='October 2011'>October 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201109' title='September 2011'>September 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201108' title='August 2011'>August 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201107' title='July 2011'>July 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201106' title='June 2011'>June 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201105' title='May 2011'>May 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201104' title='April 2011'>April 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201103' title='March 2011'>March 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201102' title='February 2011'>February 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201101' title='January 2011'>January 2011</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201012' title='December 2010'>December 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201011' title='November 2010'>November 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201010' title='October 2010'>October 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201009' title='September 2010'>September 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201008' title='August 2010'>August 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201007' title='July 2010'>July 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201006' title='June 2010'>June 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201005' title='May 2010'>May 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201004' title='April 2010'>April 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201003' title='March 2010'>March 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201002' title='February 2010'>February 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=201001' title='January 2010'>January 2010</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=200912' title='December 2009'>December 2009</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=200911' title='November 2009'>November 2009</a></li>
	<li><a href='http://learningwebgl.com/blog/?m=200910' title='October 2009'>October 2009</a></li>
		</ul>
</li><li id="meta-3" class="widget widget_meta"><h2 class="widgettitle">Meta</h2>			<ul>
						<li><a href="http://learningwebgl.com/blog/wp-login.php">Log in</a></li>
			<li><a href="http://learningwebgl.com/blog/?feed=rss2" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://learningwebgl.com/blog/?feed=comments-rss2" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>
						</ul>
</li>		</ul>
	</div>
</div>

		</div><!--/container-->
			<div id="footer">
				Copyright &copy; 2013 <a href="http://learningwebgl.com/blog"><strong>Learning WebGL</strong></a> -  3D Programming for the Web <br />
                <div class="footer-credits">
                    Powered by <a href="http://wordpress.org/">WordPress</a> | <a href="http://flexithemes.com/themes/modern-style/">Modern Style</a> theme by <a href="http://flexithemes.com/">FlexiThemes</a>
                </div>
			</div><!--/footer-->
            
	</div><!--/wrapper-->
	
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-2240015-5");
pageTracker._trackPageview();
} catch(err) {}</script>    
<script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l=document.getElementsByTagName("a"),t=document.createElement("textarea");for(i=0;l.length-i;i++){try{a=l[i].getAttribute("href");if(a&&a.indexOf("/cdn-cgi/l/email-protection") > -1  && (a.length > 28)){s='';j=27+ 1 + a.indexOf("/cdn-cgi/l/email-protection");if (a.length > j) {r=parseInt(a.substr(j,2),16);for(j+=2;a.length>j&&a.substr(j,1)!='X';j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}j+=1;s+=a.substr(j,a.length-j);}t.innerHTML=s.replace(/</g,"&lt;").replace(/>/g,"&gt;");l[i].setAttribute("href","mailto:"+t.value);}}catch(e){}}}catch(e){}})();
/* ]]> */
</script>
</body>
</html>


